# Пример торогового робота на NodeJS с использованием Tinkoff Invest Api v2

Робот разрабатывался с целью максимально просто интегрировать новые стратегии основанные на различных индикаторах технического анализа.

Всего есть 3 основные сущности:

```ts
class CandlesRobot {
  start(options): void;
  stop(): void;
}
```

CandlesRobot - это робот который может следить свечами какого-либо инструмента, и в зависимости от переданной ему стратегии, "генерировать" сигналы. На самом деле при вызове метода `candlesRobot.start()`, в него передается параметр `signalReceiver` который будет получать сигналы и делать с ними что ему угодно (здесь я отталкивался от своего минимального опыта взаимодействия с metatrader, где также есть возможность создания торговых роботов, которые могли по усмотрению пользователя, либо уведомлять его звуком, когда получали сигнал к покупке или продаже, либо торговать самостоятельно).

```ts
interface ICandlesRobotSignalReceiver {
  receive(signal: CandlesRobotSignal): void;
}
```

Конкретно в моем проекте `signalReceiver` выставляет заявки на биржу, и фиксирует прибыль или убыток, исходя из изначально заданных параметров

| Parameter | Desciption |
| --- | --- |
| `accountId`          | идентификатор аккаунта с которого будут выставляться заявки |
| `lotsPerBet`         | Количество лотов, которые будут куплены при получении сигнала |
| `maxConcurrentBets`  | Максимальное количественно одновременно открытых сигналов (Сигнал счиатется открытым, пока по нему не будут выполнены TP или SL) |
| `takeProfitPercent`  | Процент TP, то есть величина TP будет рассчитываться по формуле `instrumentPrice * (1 + takeProfitPercent)`. Указывается в формате: 0.15 (То есть, TP сработает если цена вырастет на 15%) |
| `stopLossPercent`    | Процент SL, аналогичный TP, но рассчитывается в обратную сторону `instrumentPrice * (1 - stopLossPercent)` |
| `forceCloseOnFinish` | Параметр, отвечающий за то, как `signalReceiver` будет вести себя если робота захотят остановить. В случае если в качестве значения указано `true`, то он принудительно закроет все открытые заявки, ожидающие TP или SL, и завершит работу. В случае с `false` он перестанет принимать сигналы на заявки, и завершит свою работу когда по всем открытым заявкая сработают TP и SL. <b>Important!</b> В режиме бектестинга значение всегда должно быть ```true``` |

<br/>Последняя сущность это сама стратегия

```ts
enum StrategyPredict {
  BUY,
  SELL,
}

interface IStrategy {
  predict(candles: Candle[]): StrategyPredict | undefined;
  getMinimalCandlesNumberToApply(): number;
}
```

Согласно википедии:

> Технический индикатор (технический индикатор рынка, индикатор рынка, индикатор технического анализа[1], редко технический индекс; англ. technical market indicator) — функция, построенная на значениях статистических показателей торгов (цены, объём торгов и т. д.)

<br />Большинсто всех индикаторов построенно с целью использования на графиках "японские свечи", и грубо говоря, для программирования этих индикаторов и получения предикта необходима лишь история свечей нужной длины

В качестве примера я добавил стратегию основанную на техническом индикаторе <q>BollingerBands</q>, при которой закрытие свечи выше верхней границы коридора - сигнал к покупке, закрытие ниже нижней границы - сигнал к продаже.

// TODO:
// - рассказать про бектестинг
// - добавить инструкцию запуска
